<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>H-Beam Cut & Join Calculator</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    function App() {
      const profileTypes = ["HEA", "HEB", "HEM"];

      const profiles = {
        HEA100: { b: 100, w: 17.1 }, HEA120: { b: 120, w: 20.4 },
        HEA140: { b: 140, w: 24.7 }, HEA160: { b: 160, w: 29.4 },
        HEA180: { b: 180, w: 35.5 }, HEA200: { b: 200, w: 43.0 },
        HEA220: { b: 220, w: 51.2 }, HEA240: { b: 240, w: 60.3 },
        HEA260: { b: 260, w: 70.6 }, HEA280: { b: 280, w: 81.9 },
        HEA300: { b: 300, w: 93.0 }, HEA320: { b: 320, w: 93.0 },
        HEA340: { b: 340, w: 93.0 }, HEA360: { b: 360, w: 93.0 },
        HEA400: { b: 400, w: 93.0 },

        HEB100: { b: 100, w: 20.4 }, HEB120: { b: 120, w: 26.7 },
        HEB140: { b: 140, w: 33.7 }, HEB160: { b: 160, w: 42.6 },
        HEB180: { b: 180, w: 51.2 }, HEB200: { b: 200, w: 61.3 },
        HEB220: { b: 220, w: 71.5 }, HEB240: { b: 240, w: 83.4 },
        HEB260: { b: 260, w: 93.1 }, HEB280: { b: 280, w: 106.0 },
        HEB300: { b: 300, w: 119.0 }, HEB320: { b: 320, w: 119.0 },
        HEB340: { b: 340, w: 119.0 }, HEB360: { b: 360, w: 119.0 },
        HEB400: { b: 400, w: 119.0 },

        HEM100: { b: 106, w: 42.6 }, HEM120: { b: 126, w: 53.8 },
        HEM140: { b: 146, w: 66.2 }, HEM160: { b: 166, w: 79.4 },
        HEM180: { b: 186, w: 94.2 }, HEM200: { b: 206, w: 110.0 },
        HEM220: { b: 226, w: 125.0 }, HEM240: { b: 248, w: 143.0 },
        HEM260: { b: 268, w: 155.0 }, HEM280: { b: 288, w: 173.0 },
        HEM300: { b: 310, w: 189.0 }
      };

      const translations = {
        ar: {
          title: "حاسبة قص وتجميع جناحي H مع الوزن",
          profileType: "نوع المقطع:", size: "المقاس:",
          angle: "زاوية التجميع المطلوبة (°):", length: "طول القطعة (م):",
          button: "احسب القطع والوزن", flange: "عرض الجناح العلوي:",
          cutAngle: "زاوية القص لكل جناح:", cutLength: "طول الجزء المقطوع:",
          remaining: "الجزء المتبقي من الجناح:", joint: "زاوية التجميع النهائية:",
          weightPerM: "الوزن لكل متر:", totalWeight: "الوزن الكلي:",
          ok: "✅ تمت العملية بنجاح",
          notFound: (k) => `المقطع ${k} غير موجود في الجدول`,
          invalidLen: "أدخل طولًا صالحًا (> 0)",
          invalidAngle: "الزاوية بين 5° و 60°"
        },
        en: {
          title: "H Beam Cut & Join Calculator with Weight",
          profileType: "Profile Type:", size: "Size:",
          angle: "Joint Angle (°):", length: "Length (m):",
          button: "Calculate Cut & Weight", flange: "Top Flange Width:",
          cutAngle: "Cut Angle per Flange:", cutLength: "Cut Length:",
          remaining: "Remaining Flange:", joint: "Final Joint Angle:",
          weightPerM: "Weight per Meter:", totalWeight: "Total Weight:",
          ok: "✅ Calculation successful",
          notFound: (k) => `Profile ${k} is not available`,
          invalidLen: "Enter a valid length (> 0)",
          invalidAngle: "Angle must be between 5° and 60°"
        }
      };

      const [lang, setLang] = useState("ar");
      const t = translations[lang];
      const dir = lang === "ar" ? "rtl" : "ltr";
      const align = lang === "ar" ? "text-right" : "text-left";

      const [profileType, setProfileType] = useState("HEA");
      const availableSizes = useMemo(() => {
        return Object.keys(profiles)
          .filter(k => k.startsWith(profileType))
          .map(k => k.replace(profileType, ""))
          .map(String);
      }, [profileType]);

      const [profileSize, setProfileSize] = useState("100");
      useEffect(() => {
        if (!availableSizes.includes(profileSize)) {
          setProfileSize(availableSizes[0] || "");
        }
      }, [availableSizes]);

      const [jointAngle, setJointAngle] = useState(30);
      const [length, setLength] = useState(1);
      const [result, setResult] = useState(null);
      const [error, setError] = useState("");
      const [success, setSuccess] = useState("");

      const calculate = () => {
        const key = `${profileType}${profileSize}`;
        const profile = profiles[key];

        if (!profile) { setError(t.notFound(key)); setResult(null); setSuccess(""); return; }
        if (!Number.isFinite(length) || length <= 0) { setError(t.invalidLen); setResult(null); setSuccess(""); return; }
        if (!Number.isFinite(jointAngle) || jointAngle < 5 || jointAngle > 60) { setError(t.invalidAngle); setResult(null); setSuccess(""); return; }

        setError(""); setSuccess(t.ok);

        const flangeWidth = profile.b;
        const cutAngle = jointAngle / 2;
        const angleRad = (cutAngle * Math.PI) / 180;
        const cutLength = flangeWidth * Math.tan(angleRad);
        const remainingWidth = Math.max(0, flangeWidth - cutLength);
        const weightPerMeter = profile.w;
        const totalWeight = weightPerMeter * length;

        setResult({
          flangeWidth,
          cutAngle,
          cutLength: Number(cutLength.toFixed(1)),
          remainingWidth: Number(remainingWidth.toFixed(1)),
          jointAngle,
          length,
          weightPerMeter: Number(weightPerMeter.toFixed(1)),
          totalWeight: Number(totalWeight.toFixed(2))
        });
      };

      const display = result || {
        flangeWidth: 100, cutAngle: 15, cutLength: 26.8, remainingWidth: 73.2, jointAngle: 30
      };

      const scaleY = (v) => 100 - Math.min(40, v / 3);

      return (
        <div dir={dir} className={`min-h-screen p-6 ${align}`}>
          <div className="flex justify-end mb-4">
            <select value={lang} onChange={(e)=> setLang(e.target.value)} className="p-2 border rounded">
              <option value="ar">العربية</option>
              <option value="en">English</option>
            </select>
          </div>

          <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <h1 className="text-3xl font-bold mb-6 text-center">{t.title}</h1>

            <div className="mb-4">
              <label className="block font-semibold mb-2">{t.profileType}</label>
              <select value={profileType} onChange={(e)=> setProfileType(e.target.value)} className="w-full p-2 border rounded">
                {profileTypes.map((type)=>(<option key={type} value={type}>{type}</option>))}
              </select>
            </div>

            <div className="mb-4">
              <label className="block font-semibold mb-2">{t.size}</label>
              <select value={profileSize} onChange={(e)=> setProfileSize(e.target.value)} className="w-full p-2 border rounded">
                {availableSizes.map((size)=>(<option key={size} value={size}>{size}</option>))}
              </select>
            </div>

            <div className="mb-4">
              <label className="block font-semibold mb-2">{t.angle}</label>
              <input type="range" min="5" max="60" value={jointAngle} onChange={(e)=> setJointAngle(parseInt(e.target.value))} className="w-full"/>
              <div className="text-center font-bold mt-2">{jointAngle}°</div>
            </div>

            <div className="mb-4">
              <label className="block font-semibold mb-2">{t.length}</label>
              <input type="number" min="0.1" step="0.1" value={length} onChange={(e)=> setLength(parseFloat(e.target.value))} className="w-full p-2 border rounded"/>
            </div>

            <button onClick={calculate} className="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition mb-6">
              {t.button}
            </button>

            {error && <div className="p-3 bg-red-100 text-red-700 rounded mb-6">{error}</div>}
            {success && <div className="p-3 bg-green-100 text-green-700 rounded mb-6">{success}</div>}

            {result && (
              <div className="mt-6 bg-gray-50 p-4 rounded border border-gray-200">
                <p><strong>{t.flange}</strong> {result.flangeWidth} mm</p>
                <p><strong>{t.cutAngle}</strong> {result.cutAngle}°</p>
                <p><strong>{t.cutLength}</strong> {result.cutLength} mm</p>
                <p><strong>{t.remaining}</strong> {result.remainingWidth} mm</p>
                <p><strong>{t.joint}</strong> {result.jointAngle}°</p>
                <p><strong>{t.weightPerM}</strong> {result.weightPerMeter.toFixed(1)} kg/m</p>
                <p><strong>{t.totalWeight}</strong> {result.totalWeight} kg</p>
              </div>
            )}

            <div className="mt-6">
              <h2 className="text-lg font-bold mb-4 text-center">الشكل النهائي بعد التجميع</h2>
              <div className="flex justify-center">
                <svg width="420" height="220" viewBox="0 0 420 220" xmlns="http://www.w3.org/2000/svg" className="mx-auto shadow-md p-4 bg-white rounded-lg">
                  <polygon points={`50,110 50,${scaleY(display.cutLength)} 160,80 160,140`} fill="#4f46e5" opacity="0.9" stroke="#3730a3" strokeWidth="2"/>
                  <rect x="160" y="80" width="100" height="60" fill="#1e40af" rx="3"/>
                  <polygon points={`370,110 370,${scaleY(display.cutLength)} 260,80 260,140`} fill="#3b82f6" opacity="0.9" stroke="#2563eb" strokeWidth="2"/>
                  <line x1="160" y1="80" x2="260" y2="80" stroke="#ef4444" strokeWidth="2" strokeDasharray="4"/>
                  <text x="210" y="70" fontSize="12" fill="#ef4444" textAnchor="middle">الزاوية = {display.jointAngle}°</text>
                </svg>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
